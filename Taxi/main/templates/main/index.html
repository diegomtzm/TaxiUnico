{% extends "main/base.html" %}
{% block content %}
<script>
    var map_global;
function initMap() {
    var map = new google.maps.Map(document.getElementById("map"), {
      center: {lat: 25.65625138, lng: -100.2956101},
      zoom: 16,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      disableDefaultUI: true
    });
    map_global = map;
    //getDirections(map);
}

function moveMarker(map, marker, latlng) {
    marker.setPosition(latlng);
    map.panTo(latlng);
}

function autoRefresh(map, pathCoords) {
    var i, route, marker;

    route = new google.maps.Polyline({
        path: [],
        geodesic : true,
        strokeColor: '#00000',
        strokeOpacity: 1.0,
        strokeWeight: 2,
        editable: false,
        map:map
    });

    marker=new google.maps.Marker({map:map, icon:"http://maps.google.com/mapfiles/ms/micons/red.png"});

    for (i = 0; i < pathCoords.length; i++) {
        setTimeout(function(coords) {
            route.getPath().push(coords);
            moveMarker(map, marker, coords);
        }, 700 * i, pathCoords[i]);
    }
}

function getDirections(map) {
    var directionsService = new google.maps.DirectionsService();


    var request = {
        origin: new google.maps.LatLng(25.64923743, -100.28853416),
        destination: new google.maps.LatLng(25.65628503, -100.29567832),
        travelMode: google.maps.TravelMode.DRIVING
    };
    directionsService.route(request, function(result, status) {
        if (status == google.maps.DirectionsStatus.OK) {
            autoRefresh(map, result.routes[0].overview_path);
        }
    });
}

</script>



<div id="map"></div>

<div class="container">
    <br>
    <form method="post" data-pedir-taxi="{% url 'pedir_taxi' %}">
    <div class="row justify-content-center animated bounceInUp delay-1s slow">
        <div class="col-sm-6">
                <label class="sr-only" for="inlineFormInputGroup">Direccion</label>
                <div class="input-group mb-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text"><i class="fas fa-map-marker-alt"></i></div>
                    </div>
                    <input id="origen" name="origen" type="text" class="form-control" id="inlineFormInputGroup" placeholder="Direccion" onchange="getDirections(map_global);">
                </div>
                <label class="sr-only" for="inlineFormInputGroup">Estacion</label>
                <div class="input-group mb-0">
                    <div class="input-group-prepend">
                        <div class="input-group-text"><i class="fas fa-bus"></i></div>
                    </div>
                    <input type="text" class="form-control" id="inlineFormInputGroup" placeholder="Transpais Monterrey Terminal Sur" readonly>
                    <input type="hidden" name="destino" id="destino" class="form-control" id="inlineFormInputGroup" value="Transpais Monterrey Terminal Sur">

                </div>
        </div>
    </div>
    </form>
</div>

<div class="row justify-content-center invisible">
    <div class="col-sm-6 footer" id="taxista">
        <div class="card shadow p-3 mb-4 bg-white rounded">
            <div class="col-md-2">
                <img class="card-img-top" src="https://www.bsn.eu/wp-content/uploads/2016/12/user-icon-image-placeholder-300-grey.jpg"
                    alt="Card image cap" stlye="height:50%;">
            </div>
            <div class="col-md-10">
                <h5 id="modelo" class="card-title"></h5>
                <p id="nombre_placas" class="card-text"></p>
            </div>
        </div>
    </div>
</div>


<!--    <div class="row justify-content-center">
        <div class="col-sm-12 text-center">
            <h1 class="display-1">Taxi</h1>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow p-3 mb-5 bg-white rounded">
                <div class="card-header">
                    Bienvenido {{ user.get_full_name }}
                </div>
                <div class="card-body">
                    <button type="button" class="btn btn-primary btn-block">Comprar Boleto Camion</button>

                    <a href="/reservas" class="btn btn-primary btn-block">Reservas</a>

                    <a href="/historial" class="btn btn-primary btn-block">Listar Historial</a>


                    <a href="/perfil" class="btn btn-primary btn-block">Perfil</a>

                </div>
            </div>
        </div>
    </div>


</div>
-->
</div>

{% endblock content %}
{% block javascript %}
<script>
        $("#origen").change(function () {
          var form = $(this).closest("form");
          $.ajax({
            url: form.attr("data-pedir-taxi"),
            data: form.serialize(),
            dataType: 'json',
            success: function (data) {
                $('#taxista').removeClass('invisible');
                $('#taxista').addClass('visible');
                $('#taxista').addClass('animated bounceInUp slow');
                $('#nombre_placas').text(data.nombre + " " + data.apellido + " - " + data.placas);
                $('#modelo').text(data.marca + " " + data.modelo);
            }
          });

        });
</script>
{% endblock %}